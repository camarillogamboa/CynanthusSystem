<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
    <meta charset="UTF-8">
    <title>Cynanthus Dayi</title>
</head>
<body>

<nav th:fragment="bar" class="navbar navbar-expand-sm navbar-dark p-0">
    <div class="container-fluid dayi-nav">

        <a th:href="@{/}" class="navbar-brand rounded nav-link">Cynanthus Dayi</a>

        <button class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarCollapse">

            <ul class="navbar-nav">
                <li class="nav-item mr-3">
                    <a th:href="@{/sets}" class="nav-link rounded text-white">
                        <span>Conjuntos de instrucciones</span>
                    </a>
                </li>
            </ul>

            <ul sec:authorize="hasRole('ADMIN')" class="navbar-nav">
                <li class="nav-item mr-3">
                    <a th:href="@{/users}" class="nav-link rounded text-white">
                        <span>Usuarios</span>
                    </a>
                </li>
            </ul>

            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown ml-md-auto">
                    <a href="#" class="nav-link dropdown-toggle rounded text-white" data-toggle="dropdown">
                        <i class="fas fa-user"></i>
                        <span>Bienvenido </span>
                        <span sec:authentication="name">Usuario</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="#"> Actualizar información</a>
                        <div class="dropdown-divider">
                        </div>

                        <form method="POST" th:action="@{/logout}">
                            <a href="#" onclick="this.parentNode.submit();" class="dropdown-item">
                                <i class="fas fa-user-times"></i> Cerrar sesión
                            </a>
                        </form>

                    </div>
                </li>
            </ul>

        </div>

    </div>
</nav>

<th:block th:fragment="serverNavegationBar">
    <div class="row m-0 pt-1 pr-1 pb-0 pl-1 border-bottom">
        <h5 class="w-100 text-center">Servidores</h5>
    </div>

    <div
            th:with="hasSections = !${#lists.isEmpty(serverSections)}"
            class="row flex-fill m-0"
    >

        <th:block th:if="${hasSections}">

            <div class="col p-0 overflow-auto">
                <nav class="navbar navbar-light p-1 w-100 align-items-start">
                    <!-- Iteracion por las secciones disponibles -->
                    <nav
                            th:each="serverSection: ${serverSections}"
                            th:with="sectionId = 'sectionId'+${serverSectionStat.count}"
                            th:if="!${#lists.isEmpty(serverSection.servers)}"
                            class="nav nav-pills flex-column w-100"
                    >

                        <!-- Barra de seccion de servidor (Titulo de categoria) -->
                        <div class="nav-link section-bar">
                            <button
                                    class="btn btn-block p-0 text-left"
                                    type="button"
                                    data-toggle="collapse"
                                    th:href="'#'+${sectionId}"
                                    onclick="this.blur()"
                                    role="button"
                                    aria-expanded="false"
                            >
                                <h6>
                                    <i class="fas fa-caret-right"></i>
                                    <i class="pr-2" th:classappend="${serverSection.iconName}"></i>[[${serverSection.name}]]
                                </h6>
                            </button>
                        </div>

                        <!-- Items de la seccion -->
                        <nav class="nav nav-pills flex-column w-100 pb-1">
                            <ul class="row m-0 p-0" th:id="${sectionId}">
                                <li th:each="server :${serverSection.servers}" class="nav-item m-0 p-0">

                                    <a
                                            th:id="'server'+${server.id}"
                                            th:href="@{/server/{serverId}(serverId=${server.id})}"
                                            class="nav-link ml-2 my-1"
                                            th:with="isSelected = ${currentServer} and ${server.id} == ${currentServer.id}"
                                            th:classappend="${isSelected}? 'active bg-info'"
                                    >
                                        [[${server.name}]]
                                    </a>
                                </li>
                            </ul>
                        </nav>

                    </nav>
                </nav>
            </div>

        </th:block>

        <th:block th:unless="${hasSections}">
            <div class="d-flex flex-fill text-center align-middle">
                <h6 class="m-auto">No hay servidores registrados</h6>
            </div>
        </th:block>

    </div>

    <div sec:authorize="hasRole('ADMIN')" class="row m-0">
        <button
                type="button"
                id="addServerButton"
                class="btn btn-primary btn-block rounded-bottom"
                data-toggle="modal"
                onclick="this.blur()"
                data-target="#addServerModal"
        >
            <span>
                <i class="fas fa-plus"></i> Agregar servidor
            </span>
        </button>
    </div>
</th:block>

</body>
</html>