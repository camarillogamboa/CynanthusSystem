<!DOCTYPE html>
<html
        lang="en"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
    <meta charset="UTF-8">
    <title>Cynanthus Dayi</title>
</head>
<body>

<nav th:fragment="bar" class="navbar navbar-expand-sm navbar-dark p-0">
    <div class="container-fluid dayi-nav">

        <a th:href="@{/cynanthus/dayi}" class="navbar-brand">Cynanthus Dayi</a>

        <button class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarCollapse">

            <ul class="navbar-nav">
                <li class="nav-item mr-3">
                    <a th:href="@{/cynanthus/dayi/instructions}" class="nav-link">
                        <span>Conjuntos de instrucciones</span>
                    </a>
                </li>
            </ul>

            <ul sec:authorize="hasRole('ADMIN')" class="navbar-nav">
                <li class="nav-item mr-3">
                    <a th:href="@{/cynanthus/dayi/users}" class="nav-link">
                        <span>Usuarios</span>
                    </a>
                </li>
            </ul>

            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown ml-md-auto">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                        <i class="fas fa-user"></i>
                        <span>Bienvenido </span>
                        <span sec:authentication="name">Usuario</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="#"> Actualizar información</a>
                        <div class="dropdown-divider">
                        </div>

                        <form method="POST" th:action="@{/logout}">
                            <a href="#" onclick="this.parentNode.submit();" class="dropdown-item">
                                <i class="fas fa-user-times"></i> Cerrar sesión
                            </a>
                        </form>

                    </div>
                </li>
            </ul>

        </div>

    </div>
</nav>

<div th:fragment="serversBar" class="d-flex flex-column p-0 h-100 bg-light rounded border">

    <div class="row m-0 pt-1 pr-1 pb-0 pl-1 border-bottom">
        <h5 class="w-100 text-center">Servidores</h5>
    </div>

    <div
            th:with="hasSections = !${#lists.isEmpty(serverSections)}"
            class="row m-0"
            th:classappend="${hasSections}? '' : 'flex-fill' "
    >

        <th:block th:if="${hasSections}">

            <nav class="navbar navbar-light p-1 w-100">
                <!-- Iteracion por las categorias disponibles -->
                <nav
                        th:each="serverSection : ${serverSections}"
                        th:if="!${#lists.isEmpty(serverSection.servers)}"
                        class="nav nav-pills flex-column w-100"
                >

                    <!-- Barra de categoria de servidor (Titulo de categoria) -->
                    <div class="nav-link section-bar p-1 pl-2 pt-2">
                        <h6>
                            <i class="pr-2" th:classappend="${serverSection.iconName}"></i>[[${serverSection.name}]]
                        </h6>
                    </div>

                    <!-- Items de la categoria -->
                    <nav class="nav nav-pills flex-column w-100">
                        <ul class="row m-0 p-0">
                            <li th:each="server :${serverSection.servers}" class="section-item m-0 p-0">

                                <a
                                        th:href="@{/cynanthus/dayi/server/}+${server.id}"
                                        class="nav-link ml-2 my-1"
                                        th:with="isSelected = ${currentServer} and ${server.id} == ${currentServer.id}"
                                        th:classappend="${isSelected}? (${availableServer}?'active bg-success':'active bg-danger'):'bg-light'"
                                >
                                    [[${server.name}]]
                                </a>
                            </li>
                        </ul>
                    </nav>

                </nav>
            </nav>

        </th:block>

        <th:block th:unless="${hasSections}">
            <div class="d-flex flex-fill text-center align-middle">
                <h6 class="m-auto">No hay servidores registrados</h6>
            </div>
        </th:block>

    </div>

    <div sec:authorize="hasRole('ADMIN')" class="row m-0 mt-auto">
        <button
                type="button"
                id="addServerButton"
                class="btn btn-primary btn-block rounded-bottom"
                data-toggle="modal"
                data-target="#addServerModal"
        >
            <span>
                <i class="fas fa-plus"></i> Agregar servidor
            </span>
        </button>
    </div>

</div>

</body>
</html>